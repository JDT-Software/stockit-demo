@using Stockit.Models

<MudDialog CloseButton="true">
    <DialogContent>
        <MudStack Spacing="3" AlignItems="AlignItems.Center" Class="pa-4">
            @if (IsSending)
            {
                <!-- Loading State -->
                <MudProgressCircular Color="Color.Primary" Size="Size.Large" Indeterminate="true" />
                <MudText Typo="Typo.h6" Align="Align.Center" Style="color: #252422;">
                    Sending to Supplier...
                </MudText>
                <MudText Typo="Typo.body2" Align="Align.Center" Style="color: #CCC5B9;">
                    Generating PDF and sending email
                </MudText>
            }
            else
            {
                <!-- Confirmation State -->
                <MudIcon Icon="@Icons.Material.Filled.Send" 
                         Color="Color.Primary" 
                         Style="font-size: 64px;" />
                
                <MudText Typo="Typo.h6" Align="Align.Center" Style="color: #252422;">
                    Send to Supplier?
                </MudText>
                
                <MudPaper Elevation="0" Class="pa-4" Style="background-color: #FFFCF2; border-radius: 8px; width: 100%;">
                    <MudStack Spacing="2">
                        <MudText Typo="Typo.body1" Align="Align.Center" Style="color: #403D39;">
                            Send <strong style="color: #EB5E28;">@PurchaseOrder.PONumber</strong> to
                        </MudText>
                        <MudText Typo="Typo.h6" Align="Align.Center" Style="color: #252422;">
                            @PurchaseOrder.Supplier?.SupplierName
                        </MudText>
                        <MudText Typo="Typo.body2" Align="Align.Center" Style="color: #CCC5B9;">
                            @PurchaseOrder.Supplier?.Email
                        </MudText>
                    </MudStack>
                </MudPaper>
                
                <MudText Typo="Typo.body2" Align="Align.Center" Style="color: #403D39;">
                    A professional PDF will be emailed to the supplier.
                </MudText>
            }
        </MudStack>
    </DialogContent>
    
    <DialogActions>
        @if (!IsSending)
        {
            <MudButton OnClick="Cancel" Variant="Variant.Text">Cancel</MudButton>
            <MudButton OnClick="Confirm" 
                       Color="Color.Primary" 
                       Variant="Variant.Filled" 
                       StartIcon="@Icons.Material.Filled.Send">
                Send Now
            </MudButton>
        }
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] 
    private MudBlazor.IDialogService DialogService { get; set; } = null!;

    [Parameter] 
    public PurchaseOrder PurchaseOrder { get; set; } = null!;
    
    [Parameter]
    public Func<Task>? OnConfirm { get; set; }

    private bool IsSending { get; set; } = false;

    private void Cancel()
    {
        StateHasChanged();
    }
    
    private async Task Confirm()
    {
        IsSending = true;
        StateHasChanged();

        if (OnConfirm != null)
        {
            await OnConfirm.Invoke();
        }

        // Small delay to show the spinner
        await Task.Delay(500);
        
        IsSending = false;
        StateHasChanged();
    }
}